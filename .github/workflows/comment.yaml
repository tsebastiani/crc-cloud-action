on: issue_comment

jobs:
  pr_commented:
    # This job only runs for pull request comments
    name: PR comment
    if: contains(github.event.comment.body, '/ocp-test') && contains(github.event.comment.html_url, '/pull/')
    runs-on: ubuntu-latest
    steps:
    - uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    - name: Install OC CLI
      uses: redhat-actions/oc-installer@v1
      with:
        oc_version: latest
    - uses: actions/checkout@v2
    - name: Checkout
      uses: actions/checkout@v2
      with:
        repository: tsebastiani/krkn
    - name: oc login
      run: oc login --insecure-skip-tls-verify -u kubeadmin -p kubeadmin https://api.35.92.104.60.nip.io:6443
    - name: ls
      run: ls -al
    - name: Setup kraken dependencies
      run:  pip install -r requirements.txt
    - name: Setup test suite
      run: |
        yq -i '.kraken.port="8081"' CI/config/common_test_config.yaml
        yq -i '.kraken.signal_address="0.0.0.0"' CI/config/common_test_config.yaml
        
        echo "test_app_outages_gh"  > ./CI/tests/my_tests
        echo "test_container"      >> ./CI/tests/my_tests
        echo "test_cpu_hog_gh"     >> ./CI/tests/my_tests
        echo "test_io_hog_gh"      >> ./CI/tests/my_tests
        echo "test_mem_hog_gh"     >> ./CI/tests/my_tests

    - name: Running test suite
      run: |
        ./CI/run.sh
    - name: show results
      run: ls -al CI/out

